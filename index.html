<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div>
      <div id="audio_carousel">
        <div id="carousel_container">

            <!-- 5 cards for audioplayer -->
            <div class="card">
                <!-- card top: background image -->
                <div class="audio-background-image card-img-top">
                </div>

                <!-- card body -->
                <div class="card-body">

                  <!-- description and title -->
                  <div class="audio-description">
                      <h5 class="card-title">Station 1</h5>
                      <p class="card-text">Title</p>
                  </div>

                  <!-- progress bar -->
                  <div class="progress">
                      <div class="progress-filled"></div>
                  </div>
                  <!-- start and pause button -->
                  <div class="audio-controller">
                    <div class="audio-controll-btns">
                      <div class="audio-toggle-btn">
                          <i class="far fa-play-circle audio-controll-icon"></i>
                      </div>
                    </div>
                  </div>

                </div>
            </div>

            <div class="card">
                <div class="audio-background-image card-img-top">
                </div>

                <div class="card-body">

                  <div class="audio-description">
                      <h5 class="card-title">Station 2</h5>
                      <p class="card-text">Title</p>
                  </div>

                  <div class="progress">
                      <div class="progress-filled"></div>
                  </div>
                  <div class="audio-controller">
                    <div class="audio-controll-btns">
                      <div class="audio-toggle-btn">
                          <i class="far fa-play-circle audio-controll-icon"></i>
                      </div>
                    </div>
                  </div>

                </div>
            </div>

            <div class="card">
                <div class="audio-background-image card-img-top">
                </div>

                <div class="card-body">

                  <div class="audio-description">
                      <h5 class="card-title">Station 3</h5>
                      <p class="card-text">Title</p>
                  </div>
                  <div class="progress">
                      <div class="progress-filled"></div>
                  </div>
                  <div class="audio-controller">
                    <div class="audio-controll-btns">
                      <div class="audio-toggle-btn">
                          <i class="far fa-play-circle audio-controll-icon"></i>
                      </div>
                    </div>
                  </div>

                </div>
            </div>

            <div class="card">
                <div class="audio-background-image card-img-top">
                </div>

                <div class="card-body">

                  <div class="audio-description">
                    <h5 class="card-title">Station 4</h5>
                    <p class="card-text">Title</p>
                  </div>

                  <div class="progress">
                      <div class="progress-filled"></div>
                  </div>
                  <div class="audio-controller">
                    <div class="audio-controll-btns">
                      <div class="audio-toggle-btn">
                          <i class="far fa-play-circle audio-controll-icon"></i>
                      </div>
                    </div>
                  </div>

                </div>
            </div>

            <div class="card">
                <div class="audio-background-image card-img-top">
                </div>

                <div class="card-body">

                  <div class="audio-description">
                      <h5 class="card-title">Station 5</h5>
                      <p class="card-text">Title</p>
                  </div>

                  <div class="progress">
                      <div class="progress-filled"></div>
                  </div>
                  <div class="audio-controller">
                    <div class="audio-controll-btns">
                      <div class="audio-toggle-btn">
                          <i class="far fa-play-circle audio-controll-icon"></i>
                      </div>
                    </div>
                  </div>

                </div>
            </div>

        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <!-- <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script> -->
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script>

      // setting for plugin: slick
      // http://kenwheeler.github.io/slick/
      $('#carousel_container').slick({
        arrows: true,
        centerMode: true,
        centerPadding: '10px',
        slidesToShow: 3,
        slidesToScroll: 1,
        draggable: false,
        // responsive: [
        //   {
        //     breakpoint: 768,
        //     settings: {
        //       arrows: false,
        //       centerMode: true,
        //       centerPadding: '40px',
        //       slidesToShow: 3
        //     }
        //   },
        //   {
        //     breakpoint: 480,
        //     settings: {
        //       arrows: false,
        //       centerMode: true,
        //       centerPadding: '40px',
        //       slidesToShow: 1
        //     }
        //   }
        // ]
      });


        // array for audio-src
        var audioSrc = ['https://dl.dropbox.com/s/75jpngrgnavyu7f/The-Noisy-Freaks.ogg?dl=1',
                      'http://alexkatz.me/codepen/music/interlude.mp3',
                      'https://s3-us-west-2.amazonaws.com/s.cdpn.io/355309/Swing_Jazz_Drum.mp3',
                      'https://cf-media.sndcdn.com/jJ9ynN5dIdvt.128.mp3?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiKjovL2NmLW1lZGlhLnNuZGNkbi5jb20vako5eW5ONWRJZHZ0LjEyOC5tcDMiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE1MzUyNzc4NTN9fX1dfQ__&Signature=f9fkqWJ1K9~5~FS1foz14U2VaRKw8EBSslY7TP6MnTzFAYtmasI5q6BXhF-HbwxJYIRPq-rENWEdFYtJstp5qEkllmL48eG70oH-LtHWcolvV1o2E6diyDmd2lj3fxCwVkkqFiBLAlpr67VD-gNStbDUYCRpiNTcw43GxKozxLoP-lgadw9kKW6TLYDGJZjzKH5KS7jhtLct2h7mcbP1Jjw3duZ1UC8lfT8ZoQXxQl4kDZi-NrU2JZaKxJ0Z9l4UQV-h4sruB2tQd7FvJ6zPqfKSRUDeNNvKr5zHgTfDNNlNRFFneRVFhtcmMEmXM5I2Wje8FoOgaQGuu0lHnxT2Hw__&Key-Pair-Id=APKAJAGZ7VMH2PFPW6UQ',
                      'http://alexkatz.me/codepen/music/interlude.mp3',
                      'https://dl.dropbox.com/s/75jpngrgnavyu7f/The-Noisy-Freaks.ogg?dl=1']
        var audioIndex = 0

        // get the DOM-Element of description and insert a audio tag after description
        var description = $('.card.slick-slide.slick-current.slick-active.slick-center .audio-description')
        description.after('<audio class="audio_with_controls" type="audio/mp3"></audio>')

        // get the DOM-Element of audio in current center card in carousel
        var audioElement = $('.card.slick-slide.slick-current.slick-active.slick-center .audio_with_controls')
        // set the first index bzw. src-address to src-attribut of audio
        audioElement.attr({src: audioSrc[audioIndex]})

        // get the DOM-Element of current center card in carousel
        var aktCard = $('.card.slick-slide.slick-current.slick-active.slick-center')
        // get the start buttton in current center card
        var btnInAktCard = $('.card.slick-slide.slick-current.slick-active.slick-center .audio-toggle-btn')

        aktCard.addClass('initial-click')
        var btnInAktCardBeforeInitialClick = $('.initial-click .audio-toggle-btn')

        // button for next
        var nextBtn = $('.slick-next')

      $(document).ready(() => {

        nextBtn.click(() => {
          aktCard.removeClass('initial-click')
          btnInAktCardBeforeInitialClick.removeClass('initial-click')
          btnInAktCardBeforeInitialClick = $('.initial-click')

          // remove the src value of last played audio
          audioElement.removeAttr("src")

          // get new audio index
          if(audioIndex < audioSrc.length-1) {
            audioIndex = audioIndex + 1;
          } else {
            audioIndex = 0;
          }

          // update current card and button
          aktCard = $('.card.slick-slide.slick-current.slick-active.slick-center')
          btnInAktCard = $('.card.slick-slide.slick-current.slick-active.slick-center .audio-toggle-btn')
          audioElement.attr({src: audioSrc[audioIndex]})
          // console.log('audioElem: 2',audioElement[0])

          btnInAktCard.click(() => {
            // // audioElement.setAttribute('src', audioSrc[audioIndex])
            // audioElement.attr({src: audioSrc[audioIndex]})
            if(!audioElement.paused) {
              // console.log('audioElem: 3', audioElement[0])
              audio_toggle_play(audioElement[0])
            }

          })

          $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('click', scrub)

          let mousedown = false;
          $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mousemove', (e) => mousedown && scrub(e))
          $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mousedown', () => mousedown = true)
          $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mouseup', () => mousedown = false)

        })


        btnInAktCardBeforeInitialClick.click(() => {
          // console.log(btnInAktCardBeforeInitialClick.length)
          if(btnInAktCardBeforeInitialClick.length !== 0)
            audio_toggle_play(audioElement[0])
        })

        /**
        * Funktion to controll start and pause of audio
        */
        function audio_toggle_play(audioElement) {
          if(audioElement.paused) {
            audioElement.play()
            // change icon
            $('.card.slick-slide.slick-current.slick-active.slick-center .audio-controll-icon').replaceWith('<i class="far fa-pause-circle audio-controll-icon"></i>');
          } else {
            audioElement.pause()
            $('.card.slick-slide.slick-current.slick-active.slick-center .audio-controll-icon').replaceWith('<i class="far fa-play-circle audio-controll-icon"></i>');
          }
        }

        /**
        * Funktion to change the styling of the processbar
        */
        function handleProcess() {
          const percent = (audioElement[0].currentTime / audioElement[0].duration) * 100;
          $('.card.slick-slide.slick-current.slick-active.slick-center .progress-filled').css('flexBasis', `${percent}%`)
        }

        /**
        * Funktion to change the process (current time) of the audio by draging the process bar
        */
        function scrub(e) {
          const scrubTime = (e.offsetX / $('.card.slick-slide.slick-current.slick-active.slick-center .progress').outerWidth()) * audioElement[0].duration;
          audioElement[0].currentTime = scrubTime;
        }
        // evnet listeners
        $('.card.slick-slide.slick-current.slick-active.slick-center audio').on('timeupdate', handleProcess)
        $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('click', scrub)

        let mousedown = false;
        $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mousemove', (e) => mousedown && scrub(e))
        $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mousedown', () => mousedown = true)
        $('.card.slick-slide.slick-current.slick-active.slick-center .progress').on('mouseup', () => mousedown = false)



      })

    </script>
  </body>

</html>